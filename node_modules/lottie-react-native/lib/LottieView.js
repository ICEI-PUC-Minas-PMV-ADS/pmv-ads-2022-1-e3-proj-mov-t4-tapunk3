var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _reactNativeSafeModules=_interopRequireDefault(require("react-native-safe-modules"));var _propTypes=_interopRequireDefault(require("prop-types"));var _jsxFileName="/Users/emiliorodriguez/lottie-react-native/src/js/LottieView.js";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}var getNativeLottieViewForDesktop=function getNativeLottieViewForDesktop(){return(0,_reactNative.requireNativeComponent)('LottieAnimationView');};var NativeLottieView=_reactNative.Platform.OS==='macos'||_reactNative.Platform.OS==='windows'?getNativeLottieViewForDesktop():_reactNativeSafeModules.default.component({viewName:'LottieAnimationView',mockComponent:_reactNative.View});var AnimatedNativeLottieView=_reactNative.Animated.createAnimatedComponent(NativeLottieView);var LottieViewManager=_reactNative.Platform.select({macos:_reactNative.NativeModules.LottieAnimationView,windows:_reactNative.NativeModules.LottieAnimationView,default:_reactNativeSafeModules.default.module({moduleName:'LottieAnimationView',mock:{play:function play(){},reset:function reset(){},pause:function pause(){},resume:function resume(){},getConstants:function getConstants(){}}})});var ViewStyleExceptBorderPropType=function ViewStyleExceptBorderPropType(props,propName,componentName){var flattened=_reactNative.StyleSheet.flatten(props[propName]||{});var usesBorder=Object.keys(flattened).some(function(key){return key.startsWith('border');});if(usesBorder){return Error(componentName+" does not allow any border related style properties to be specified. "+"Border styles for this component will behave differently across platforms. If you'd "+'like to render a border around this component, wrap it with a View.');}for(var _len=arguments.length,rest=new Array(_len>3?_len-3:0),_key=3;_key<_len;_key++){rest[_key-3]=arguments[_key];}return _reactNative.ViewPropTypes.style.apply(_reactNative.ViewPropTypes,[props,propName,componentName].concat(rest));};var NotAllowedPropType=function NotAllowedPropType(props,propName,componentName){var value=props[propName];if(value!=null){return Error(componentName+" cannot specify '"+propName+"'.");}return null;};var propTypes=_objectSpread(_objectSpread({},_reactNative.ViewPropTypes),{},{style:ViewStyleExceptBorderPropType,children:NotAllowedPropType,resizeMode:_propTypes.default.oneOf(['cover','contain','center']),progress:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.object]),speed:_propTypes.default.number,duration:_propTypes.default.number,loop:_propTypes.default.bool,autoPlay:_propTypes.default.bool,autoSize:_propTypes.default.bool,enableMergePathsAndroidForKitKatAndAbove:_propTypes.default.bool,source:_propTypes.default.oneOfType([_propTypes.default.object,_propTypes.default.string]).isRequired,onAnimationFinish:_propTypes.default.func,onLayout:_propTypes.default.func,cacheComposition:_propTypes.default.bool});var defaultProps={progress:0,speed:1,loop:true,autoPlay:false,autoSize:false,enableMergePathsAndroidForKitKatAndAbove:false,cacheComposition:true,resizeMode:'contain'};var viewConfig={uiViewClassName:'LottieAnimationView',validAttributes:{progress:true}};var safeGetViewManagerConfig=function safeGetViewManagerConfig(moduleName){if(_reactNative.UIManager.getViewManagerConfig){return _reactNative.UIManager.getViewManagerConfig(moduleName);}return _reactNative.UIManager[moduleName];};var LottieView=function(_React$PureComponent){(0,_inherits2.default)(LottieView,_React$PureComponent);var _super=_createSuper(LottieView);function LottieView(props){var _this;(0,_classCallCheck2.default)(this,LottieView);_this=_super.call(this,props);_this.viewConfig=viewConfig;_this.refRoot=_this.refRoot.bind((0,_assertThisInitialized2.default)(_this));_this.onAnimationFinish=_this.onAnimationFinish.bind((0,_assertThisInitialized2.default)(_this));_this.onLayout=_this.onLayout.bind((0,_assertThisInitialized2.default)(_this));return _this;}(0,_createClass2.default)(LottieView,[{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){if(this.props.source.nm!==prevProps.source.nm&&this.props.autoPlay){this.play();}}},{key:"setNativeProps",value:function setNativeProps(props){_reactNative.UIManager.updateView(this.getHandle(),this.viewConfig.uiViewClassName,{progress:props.progress});}},{key:"play",value:function play(){var startFrame=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;var endFrame=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;this.runCommand('play',[startFrame,endFrame]);}},{key:"reset",value:function reset(){this.runCommand('reset');}},{key:"pause",value:function pause(){this.runCommand('pause');}},{key:"resume",value:function resume(){this.runCommand('resume');}},{key:"runCommand",value:function runCommand(name){var _this2=this;var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var handle=this.getHandle();if(!handle){return null;}return _reactNative.Platform.select({android:function android(){return _reactNative.UIManager.dispatchViewManagerCommand(handle,safeGetViewManagerConfig('LottieAnimationView').Commands[name],args);},windows:function windows(){return _reactNative.UIManager.dispatchViewManagerCommand(handle,safeGetViewManagerConfig('LottieAnimationView').Commands[name],args);},ios:function ios(){return LottieViewManager[name].apply(LottieViewManager,[_this2.getHandle()].concat((0,_toConsumableArray2.default)(args)));},macos:function macos(){return LottieViewManager[name].apply(LottieViewManager,[_this2.getHandle()].concat((0,_toConsumableArray2.default)(args)));}})();}},{key:"getHandle",value:function getHandle(){return(0,_reactNative.findNodeHandle)(this.root);}},{key:"refRoot",value:function refRoot(root){this.root=root;if(this.props.autoPlay){this.play();}}},{key:"onAnimationFinish",value:function onAnimationFinish(evt){if(this.props.onAnimationFinish){this.props.onAnimationFinish(evt.nativeEvent.isCancelled);}}},{key:"onLayout",value:function onLayout(evt){if(this.props.onLayout){this.props.onLayout(evt);}}},{key:"render",value:function render(){var _this$props=this.props,style=_this$props.style,source=_this$props.source,autoSize=_this$props.autoSize,rest=(0,_objectWithoutProperties2.default)(_this$props,["style","source","autoSize"]);var sourceName=typeof source==='string'?source:undefined;var sourceJson=typeof source==='string'?undefined:JSON.stringify(source);var aspectRatioStyle=sourceJson?{aspectRatio:source.w/source.h}:undefined;var styleObject=_reactNative.StyleSheet.flatten(style);var sizeStyle;if(!styleObject||styleObject.width===undefined&&styleObject.height===undefined){sizeStyle=autoSize&&sourceJson?{width:source.w}:_reactNative.StyleSheet.absoluteFill;}var speed=this.props.duration&&sourceJson&&this.props.source.fr?Math.round(this.props.source.op/this.props.source.fr*1000/this.props.duration):this.props.speed;var colorFilters=Array.isArray(this.props.colorFilters)?this.props.colorFilters.map(function(_ref){var keypath=_ref.keypath,color=_ref.color;return{keypath:keypath,color:(0,_reactNative.processColor)(color)};}):undefined;return _react.default.createElement(_reactNative.View,{style:[aspectRatioStyle,sizeStyle,style],__self:this,__source:{fileName:_jsxFileName,lineNumber:221,columnNumber:7}},_react.default.createElement(AnimatedNativeLottieView,(0,_extends2.default)({ref:this.refRoot},rest,{colorFilters:colorFilters,speed:speed,style:[aspectRatioStyle,sizeStyle||{width:'100%',height:'100%'},style],sourceName:sourceName,sourceJson:sourceJson,onAnimationFinish:this.onAnimationFinish,onLayout:this.onLayout,__self:this,__source:{fileName:_jsxFileName,lineNumber:222,columnNumber:9}})));}}]);return LottieView;}(_react.default.PureComponent);LottieView.propTypes=propTypes;LottieView.defaultProps=defaultProps;module.exports=LottieView;